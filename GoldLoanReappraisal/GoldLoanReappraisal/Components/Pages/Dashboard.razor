@page "/dashboard"
@using GoldLoanReappraisal.Components.Layout
@using GoldLoanReappraisal.Data.Services
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@layout EmptyLayout
@attribute [Authorize]
@inject NavigationMenuService NavMenuService

<PageTitle>Dashboard</PageTitle>

<div class="page">
    <div class="sidebar">

        <div class="sidebar-header">
            <h2>Navigation</h2>
        </div>

        <div class="sidebar-nav">
            <nav class="flex-column">
                <CascadingAuthenticationState>
                    <AuthorizeView>
                        <Authorized>
                            @foreach (var item in NavMenuService.GetAllowedMenuItems(context.User))
                            {
                                <div class="nav-item px-3">
                                    <NavLink class="nav-link" href="@item.Href" Match="NavLinkMatch.All">
                                        <span class="bi @item.IconCssClass" aria-hidden="true"></span> @item.Title
                                    </NavLink>
                                </div>
                            }
                        </Authorized>
                    </AuthorizeView>
                </CascadingAuthenticationState>
            </nav>
        </div>

    </div>
    <main>
        <div class="dashboard-content-container">
            <AuthorizeView>
                <Authorized>
                    @{
                        var userId = context.User.Identity?.Name;
                        var branchName = context.User.FindFirst("BranchName")?.Value;
                        var regionName = context.User.FindFirst("RegionName")?.Value;
                        var zoneName = context.User.FindFirst("ZoneName")?.Value;
                    }
                    <div class="profile-card">
                        <div class="profile-header">
                            User Profile
                        </div>
                        <div class="profile-body">
                            <dl class="row">
                                <dt class="col-sm-4">User ID</dt>
                                <dd class="col-sm-8">@userId</dd>

                                <dt class="col-sm-4">Branch</dt>
                                <dd class="col-sm-8">@branchName</dd>

                                <dt class="col-sm-4">Region</dt>
                                <dd class="col-sm-8">@regionName</dd>

                                <dt class="col-sm-4">Zone</dt>
                                <dd class="col-sm-8">@zoneName</dd>
                            </dl>
                        </div>
                    </div>
                </Authorized>
            </AuthorizeView>
        </div>
    </main>
    </div>